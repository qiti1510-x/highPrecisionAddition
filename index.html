<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>高精度加法·分步计算演示（含C++代码同步高亮）</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: '微软雅黑', sans-serif; max-width: 1400px; margin: 20px auto; padding: 0 20px; }
        
        /* 左右分栏布局 */
        .container {
            display: flex;
            gap: 20px;
        }
        
        /* 左边演示区域（占60%） */
        .demo-area {
            flex: 1 1 60%;
        }
        
        /* 右边代码区域（占40%） */
        .code-area {
            flex: 1 1 40%;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Consolas', '微软雅黑', monospace;
        }
        
        /* 输入区域样式（保持原风格） */
        .input-box {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .input-box input {
            padding: 10px;
            font-size: 16px;
            width: 250px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .input-box button {
            padding: 10px 20px;
            font-size: 16px;
            background: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        /* 控制区域样式（保持原风格） */
        .control-box {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 20px;
            display: none;
        }
        .control-box button {
            padding: 10px 20px;
            font-size: 16px;
            background: #28a745;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .control-box button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .carry-info {
            font-size: 16px;
            color: #333;
        }
        .carry-info span {
            font-weight: bold;
            color: #dc3545;
        }
        
        /* 数组显示区域样式（保持原风格） */
        .array-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .array-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .array-container {
            display: flex;
            gap: 10px;
            margin-bottom: 5px;
        }
        .array-item {
            width: 60px;
            height: 60px;
            line-height: 60px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 20px;
            background: #fff;
        }
        .array-item.current {
            background: #ffeb3b;
            border-color: #fbc02d;
            font-weight: bold;
        }
        .index-labels {
            display: flex;
            gap: 10px;
        }
        .index-label {
            width: 60px;
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        
        /* 结果区域样式（保持原风格） */
        .result-box {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-top: 2px solid #007bff;
            display: none;
        }
        .result-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        .result-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        
        /* 代码区域样式 */
        .code-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .code-container {
            font-size: 14px;
            line-height: 1.8;
            color: #333;
            max-height: 600px;
            overflow-y: auto;
            padding-left: 35px; /* 给行号留空间 */
        }
        .code-line {
            position: relative;
            padding: 0 10px;
            margin: 2px 0;
            transition: background 0.3s, border-left 0.3s;
        }
        /* 行号样式 */
        .code-line::before {
            content: attr(data-line);
            position: absolute;
            left: -35px;
            top: 0;
            width: 30px;
            text-align: right;
            color: #999;
            font-size: 14px;
            line-height: 1.8;
        }
        /* 代码高亮样式（与演示区域当前位一致） */
        .code-line.highlight {
            background: #ffeb3b;
            border-left: 3px solid #fbc02d;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 左边：演示区域 -->
        <div class="demo-area">
            <!-- 1. 输入区域 -->
            <div class="input-box">
                <input type="text" id="num1Input" placeholder="输入第一个数（如6757）" required>
                <input type="text" id="num2Input" placeholder="输入第二个数（如675）" required>
                <button id="initBtn">初始化数组</button>
            </div>

            <!-- 2. 控制与进位显示区域 -->
            <div class="control-box" id="controlBox">
                <button id="nextBtn" disabled>下一步</button>
                <div class="carry-info">当前进位：<span id="carryValue">0</span></div>
            </div>

            <!-- 3. 数组显示区域（0号下标在左边） -->
            <div class="array-group" id="arrayGroup" style="display: none;">
                <!-- 数字1数组（逆序存储） -->
                <div class="array-section">
                    <div class="array-title">数字1（num1Arr，反着存）</div>
                    <div class="array-container" id="num1Array"></div>
                    <div class="index-labels" id="num1Indexes"></div>
                </div>

                <!-- 数字2数组（逆序存储） -->
                <div class="array-section">
                    <div class="array-title">数字2（num2Arr，反着存）</div>
                    <div class="array-container" id="num2Array"></div>
                    <div class="index-labels" id="num2Indexes"></div>
                </div>

                <!-- 结果数组（逆序存储） -->
                <div class="array-section">
                    <div class="array-title">结果（resultArr，反着存）</div>
                    <div class="array-container" id="resultArray"></div>
                    <div class="index-labels" id="resultIndexes"></div>
                </div>
            </div>

            <!-- 4. 最终结果区域（逆序输出） -->
            <div class="result-box" id="resultBox">
                <div class="result-title">最终结果（逆序输出）</div>
                <div class="result-value" id="finalResult"></div>
            </div>
        </div>

        <!-- 右边：C++代码区域 -->
        <div class="code-area">
            <div class="code-title">高精度加法·C++代码</div>
            <div class="code-container">
                <div class="code-line" data-line="1">#include &lt;iostream&gt;</div>
                <div class="code-line" data-line="2">#include &lt;string&gt;</div>
                <div class="code-line" data-line="3">using namespace std;</div>
                <div class="code-line" data-line="4"></div>
                <div class="code-line" data-line="5">int a[505], b[505], c[505];</div>
                <div class="code-line" data-line="6"></div>
                <div class="code-line" data-line="7">int main() {</div>
                <div class="code-line" data-line="8">    string s1, s2;</div>
                <div class="code-line" data-line="9">    cin >> s1 >> s2;</div>
                <div class="code-line" data-line="10">    int la = s1.size(), lb = s2.size();</div>
                <div class="code-line" data-line="11">    // 将s1逆序存入a数组（个位在a[0]）</div>
                <div class="code-line" data-line="12">    for (int i = 0; i < la; i++) {</div>
                <div class="code-line" data-line="13">        a[i] = s1[la - 1 - i] - '0';</div>
                <div class="code-line" data-line="14">    }</div>
                <div class="code-line" data-line="15">    // 将s2逆序存入b数组（个位在b[0]）</div>
                <div class="code-line" data-line="16">    for (int i = 0; i < lb; i++) {</div>
                <div class="code-line" data-line="17">        b[i] = s2[lb - 1 - i] - '0';</div>
                <div class="code-line" data-line="18">    }</div>
                <div class="code-line" data-line="19">    // 计算数组最大长度（补零对齐）</div>
                <div class="code-line" data-line="20">    int lc = max(la, lb);</div>
                <div class="code-line" data-line="21">    // 初始化结果数组为0</div>
                <div class="code-line" data-line="22">    for (int i = 0; i < lc; i++) {</div>
                <div class="code-line" data-line="23">        c[i] = 0;</div>
                <div class="code-line" data-line="24">    }</div>
                <div class="code-line" data-line="25">    // 分步计算每一位（个位→高位）</div>
                <div class="code-line" data-line="26">    for (int i = 0; i < lc; i++) {</div>
                <div class="code-line" data-line="27">        c[i] += a[i] + b[i];       // 当前位和（加上之前的进位）</div>
                <div class="code-line" data-line="28">        c[i+1] = c[i] / 10;        // 计算进位到下一位</div>
                <div class="code-line" data-line="29">        c[i] %= 10;                 // 当前位取余（保留个位）</div>
                <div class="code-line" data-line="30">    }</div>
                <div class="code-line" data-line="31">    // 处理最终进位（如果有）</div>
                <div class="code-line" data-line="32">    if (c[lc] > 0) {</div>
                <div class="code-line" data-line="33">        lc++;</div>
                <div class="code-line" data-line="34">    }</div>
                <div class="code-line" data-line="35">    // 逆序输出结果（从高位到低位）</div>
                <div class="code-line" data-line="36">    for (int i = lc - 1; i >= 0; i--) {</div>
                <div class="code-line" data-line="37">        cout << c[i];</div>
                <div class="code-line" data-line="38">    }</div>
                <div class="code-line" data-line="39">    cout << endl;</div>
                <div class="code-line" data-line="40">    return 0;</div>
                <div class="code-line" data-line="41">}</div>
            </div>
        </div>
    </div>

    <script>
        // ------------------------------
        // 状态变量（核心：控制分步计算）
        // ------------------------------
        let num1Arr = [];          // 数字1的逆序数组（如6757→[7,5,7,6]）
        let num2Arr = [];          // 数字2的逆序数组（如675→[5,7,6,0]）
        let resultArr = [];        // 结果逆序数组（如[2,3,4,7]）
        let currentIndex = 0;      // 当前处理的index（从0开始，最左边）
        let carry = 0;             // 当前进位（初始0）
        let maxLength = 0;         // 数组最大长度（补零后）
        let isCalculating = false; // 防止重复点击的锁

        // ------------------------------
        // DOM元素获取
        // ------------------------------
        const num1Input = document.getElementById('num1Input');
        const num2Input = document.getElementById('num2Input');
        const initBtn = document.getElementById('initBtn');
        const controlBox = document.getElementById('controlBox');
        const nextBtn = document.getElementById('nextBtn');
        const carryValue = document.getElementById('carryValue');
        const arrayGroup = document.getElementById('arrayGroup');
        const num1Array = document.getElementById('num1Array');
        const num1Indexes = document.getElementById('num1Indexes');
        const num2Array = document.getElementById('num2Array');
        const num2Indexes = document.getElementById('num2Indexes');
        const resultArray = document.getElementById('resultArray');
        const resultIndexes = document.getElementById('resultIndexes');
        const resultBox = document.getElementById('resultBox');
        const finalResult = document.getElementById('finalResult');

        // ------------------------------
        // 核心函数：高亮C++代码行
        // ------------------------------
        function highlightCodeLines(lineNumbers) {
            // 移除所有行的高亮
            document.querySelectorAll('.code-line').forEach(line => {
                line.classList.remove('highlight');
            });
            // 高亮指定行号的行
            lineNumbers.forEach(line => {
                const codeLine = document.querySelector(`.code-line[data-line="${line}"]`);
                if (codeLine) {
                    codeLine.classList.add('highlight');
                }
            });
        }

        // ------------------------------
        // 核心逻辑1：初始化数组（输入→逆序存储→补零对齐）
        // ------------------------------
        initBtn.addEventListener('click', () => {
            const num1 = num1Input.value.trim();
            const num2 = num2Input.value.trim();

            // 1. 输入验证（仅数字）
            if (!/^\d+$/.test(num1) || !/^\d+$/.test(num2)) {
                alert('请输入纯数字！');
                return;
            }
            if (!num1 || !num2) {
                alert('请输入两个数字！');
                return;
            }

            // 2. 逆序存储数组（关键：输入字符串反转后的数组）
            num1Arr = num1.split('').reverse().map(Number);  // 6757→["6","7","5","7"]→反转→["7","5","7","6"]→转数字→[7,5,7,6]
            num2Arr = num2.split('').reverse().map(Number);  // 675→["6","7","5"]→反转→["5","7","6"]→转数字→[5,7,6]
            maxLength = Math.max(num1Arr.length, num2Arr.length);
            num1Arr = padZero(num1Arr, maxLength);           // 补零到maxLength（如[5,7,6]→[5,7,6,0]）
            num2Arr = padZero(num2Arr, maxLength);           // 补零到maxLength

            // 3. 初始化结果数组（长度与maxLength一致，初始为0）
            resultArr = new Array(maxLength).fill(0);

            // 4. 显示数组（0号下标在左边）
            displayArray(num1Array, num1Indexes, num1Arr);   // 显示num1Arr→[7,5,7,6]→左边是7（index=0），右边是6（index=3）
            displayArray(num2Array, num2Indexes, num2Arr);   // 显示num2Arr→[5,7,6,0]→左边是5（index=0），右边是0（index=3）
            displayArray(resultArray, resultIndexes, resultArr); // 显示resultArr→[0,0,0,0]→左边是0（index=0），右边是0（index=3）

            // 5. 初始化状态（重置分步计算的变量）
            currentIndex = 0;
            carry = 0;
            carryValue.textContent = carry; // 初始进位显示0
            isCalculating = false;
            nextBtn.disabled = false;       // 启用下一步按钮
            nextBtn.textContent = '下一步'; // 重置按钮文本

            // 6. 显示交互区域
            controlBox.style.display = 'flex';
            arrayGroup.style.display = 'block';
            resultBox.style.display = 'none'; // 隐藏最终结果（未计算完成）

            // 7. 高亮C++初始化相关代码（读取输入、处理数组、计算最大长度）
            highlightCodeLines([7,8,9,12,13,14,16,17,18,20]);
        });

        // ------------------------------
        // 核心逻辑2：补零函数（使数组长度一致）
        // ------------------------------
        function padZero(arr, length) {
            while (arr.length < length) {
                arr.push(0); // 在数组末尾补零（不影响0号下标的位置）
            }
            return arr;
        }

        // ------------------------------
        // 核心逻辑3：显示数组（0号下标在左边，从左到右index递增）
        // ------------------------------
        function displayArray(arrayContainer, indexContainer, arr) {
            arrayContainer.innerHTML = '';
            indexContainer.innerHTML = '';

            // 直接遍历数组，按顺序显示（i=0在最左边，对应index=0）
            arr.forEach((item, i) => {
                // 1. 数字项：显示数组元素，i是实际的index
                const itemDiv = document.createElement('div');
                itemDiv.className = 'array-item';
                itemDiv.textContent = item;
                itemDiv.dataset.index = i; // 存储实际index（用于标亮）
                arrayContainer.appendChild(itemDiv);

                // 2. index标签：显示index=${i}（从左到右递增）
                const indexDiv = document.createElement('div');
                indexDiv.className = 'index-label';
                indexDiv.textContent = `index=${i}`;
                indexContainer.appendChild(indexDiv);
            });
        }

        // ------------------------------
        // 核心逻辑4：分步计算（点击下一步→处理一个index位）
        // ------------------------------
        nextBtn.addEventListener('click', () => {
            // 1. 防止重复点击或计算完成
            if (isCalculating || currentIndex > maxLength) return;
            isCalculating = true;

            // 2. 处理完所有位的情况（检查进位）
            if (currentIndex === maxLength) {
                handleFinalCarry(); // 处理剩余进位
                return;
            }

            // 3. 标亮当前处理的index位（数字1、数字2、结果数组）
            highlightCurrentIndex(currentIndex);

            // 4. 计算当前位的sum（数字和+进位）
            const num1 = num1Arr[currentIndex];
            const num2 = num2Arr[currentIndex];
            const sum = num1 + num2 + carry;

            // 5. 计算结果位与新进位
            const resultDigit = sum % 10; // 结果位（取余10）
            const newCarry = Math.floor(sum / 10); // 新进位（除10取整）

            // 6. 更新结果数组与进位
            resultArr[currentIndex] = resultDigit; // 更新结果数组的当前位
            carry = newCarry; // 更新进位
            carryValue.textContent = carry; // 实时显示进位变化

            // 7. 高亮C++当前计算步骤代码（处理每一位的和、进位、取余）
            highlightCodeLines([26,27,28,29]);

            // 8. 延迟0.5秒→取消标亮（让用户看清楚当前位）
            setTimeout(() => {
                unhighlightCurrentIndex(currentIndex); // 取消标亮
                displayArray(resultArray, resultIndexes, resultArr); // 更新结果数组显示
                currentIndex++; // 处理下一个index
                isCalculating = false; // 解锁

                // 9. 检查是否处理完所有位（currentIndex === maxLength）
                if (currentIndex === maxLength) {
                    nextBtn.textContent = '处理进位'; // 提示用户处理进位
                }
            }, 500);
        });

        // ------------------------------
        // 核心逻辑5：处理剩余进位（计算完成后）
        // ------------------------------
        function handleFinalCarry() {
            // 1. 如果有进位→添加到结果数组末尾
            if (carry > 0) {
                resultArr.push(carry); // 进位作为新的最高位（逆序存储）
                displayArray(resultArray, resultIndexes, resultArr); // 更新结果数组显示
                carry = 0; // 重置进位
                carryValue.textContent = carry; // 显示0
            }

            // 2. 高亮C++处理进位代码
            highlightCodeLines([32,33,34]);

            // 3. 延迟0.5秒→显示最终结果（让用户看清楚进位处理）
            setTimeout(() => {
                // 生成最终结果（逆序输出resultArr）
                const final = resultArr.reverse().join(''); // 如[2,3,4,7]→反转→[7,4,3,2]→join→"7432"
                finalResult.textContent = final;
                resultBox.style.display = 'block'; // 显示最终结果

                // 4. 高亮C++输出结果代码
                highlightCodeLines([36,37,38]);

                // 5. 禁用按钮（计算完成）
                nextBtn.disabled = true;
                nextBtn.textContent = '计算完成';
            }, 500);
        }

        // ------------------------------
        // 核心逻辑6：标亮当前处理的index位（黄色背景）
        // ------------------------------
        function highlightCurrentIndex(index) {
            // 标亮数字1的当前index位
            const num1Items = document.querySelectorAll('#num1Array .array-item');
            if (num1Items[index]) num1Items[index].classList.add('current');

            // 标亮数字2的当前index位
            const num2Items = document.querySelectorAll('#num2Array .array-item');
            if (num2Items[index]) num2Items[index].classList.add('current');

            // 标亮结果数组的当前index位（未计算时是0，计算后更新）
            const resultItems = document.querySelectorAll('#resultArray .array-item');
            if (resultItems[index]) resultItems[index].classList.add('current');
        }

        // ------------------------------
        // 核心逻辑7：取消标亮当前位（恢复默认背景）
        // ------------------------------
        function unhighlightCurrentIndex(index) {
            // 取消数字1的标亮
            const num1Items = document.querySelectorAll('#num1Array .array-item');
            if (num1Items[index]) num1Items[index].classList.remove('current');

            // 取消数字2的标亮
            const num2Items = document.querySelectorAll('#num2Array .array-item');
            if (num2Items[index]) num2Items[index].classList.remove('current');

            // 取消结果数组的标亮
            const resultItems = document.querySelectorAll('#resultArray .array-item');
            if (resultItems[index]) resultItems[index].classList.remove('current');
        }
    </script>
</body>
</html>